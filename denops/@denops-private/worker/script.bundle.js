class DenoStdInternalError extends Error{constructor(e){super(e);this.name="DenoStdInternalError"}}function assert(t,e=""){if(!t)throw new DenoStdInternalError(e)}const{hasOwn}=Object,osType=(()=>{const{Deno:t}=globalThis;if(typeof t?.build?.os=="string")return t.build.os;const{navigator:e}=globalThis;return e?.appVersion?.includes?.("Win")??!1?"windows":"linux"})(),isWindows=osType==="windows",CHAR_FORWARD_SLASH=47;function assertPath(t){if(typeof t!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function isPosixPathSeparator(t){return t===47}function isPathSeparator(t){return isPosixPathSeparator(t)||t===92}function isWindowsDeviceRoot(t){return t>=97&&t<=122||t>=65&&t<=90}function normalizeString(t,e,i,r){let n="",s=0,o=-1,l=0,a;for(let f=0,c=t.length;f<=c;++f){if(f<c)a=t.charCodeAt(f);else{if(r(a))break;a=CHAR_FORWARD_SLASH}if(r(a)){if(!(o===f-1||l===1))if(o!==f-1&&l===2){if(n.length<2||s!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46){if(n.length>2){const h=n.lastIndexOf(i);h===-1?(n="",s=0):(n=n.slice(0,h),s=n.length-1-n.lastIndexOf(i)),o=f,l=0;continue}else if(n.length===2||n.length===1){n="",s=0,o=f,l=0;continue}}e&&(n.length>0?n+=`${i}..`:n="..",s=2)}else n.length>0?n+=i+t.slice(o+1,f):n=t.slice(o+1,f),s=f-o-1;o=f,l=0}else a===46&&l!==-1?++l:l=-1}return n}function _format(t,e){const i=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return i?i===e.root?i+r:i+t+r:r}const WHITESPACE_ENCODINGS={"	":"%09","\n":"%0A","\v":"%0B","\f":"%0C","\r":"%0D"," ":"%20"};function encodeWhitespace(t){return t.replaceAll(/[\s]/g,e=>WHITESPACE_ENCODINGS[e]??e)}const sep="\\",delimiter=";";function resolve(...t){let e="",i="",r=!1;for(let n=t.length-1;n>=-1;n--){let s;const{Deno:o}=globalThis;if(n>=0)s=t[n];else if(e){if(typeof o?.env?.get!="function"||typeof o?.cwd!="function")throw new TypeError("Resolved a relative path without a CWD.");s=o.cwd(),(s===void 0||s.slice(0,3).toLowerCase()!==`${e.toLowerCase()}\\`)&&(s=`${e}\\`)}else{if(typeof o?.cwd!="function")throw new TypeError("Resolved a drive-letter-less path without a CWD.");s=o.cwd()}assertPath(s);const l=s.length;if(l===0)continue;let a=0,f="",c=!1;const h=s.charCodeAt(0);if(l>1)if(isPathSeparator(h))if(c=!0,isPathSeparator(s.charCodeAt(1))){let u=2,E=u;for(;u<l&&!isPathSeparator(s.charCodeAt(u));++u);if(u<l&&u!==E){const w=s.slice(E,u);for(E=u;u<l&&isPathSeparator(s.charCodeAt(u));++u);if(u<l&&u!==E){for(E=u;u<l&&!isPathSeparator(s.charCodeAt(u));++u);u===l?(f=`\\\\${w}\\${s.slice(E)}`,a=u):u!==E&&(f=`\\\\${w}\\${s.slice(E,u)}`,a=u)}}}else a=1;else isWindowsDeviceRoot(h)&&s.charCodeAt(1)===58&&(f=s.slice(0,2),a=2,l>2&&isPathSeparator(s.charCodeAt(2))&&(c=!0,a=3));else isPathSeparator(h)&&(a=1,c=!0);if(!(f.length>0&&e.length>0&&f.toLowerCase()!==e.toLowerCase())&&(e.length===0&&f.length>0&&(e=f),r||(i=`${s.slice(a)}\\${i}`,r=c),r&&e.length>0))break}return i=normalizeString(i,!r,"\\",isPathSeparator),e+(r?"\\":"")+i||"."}function normalize(t){assertPath(t);const e=t.length;if(e===0)return".";let i=0,r,n=!1;const s=t.charCodeAt(0);if(e>1)if(isPathSeparator(s))if(n=!0,isPathSeparator(t.charCodeAt(1))){let l=2,a=l;for(;l<e&&!isPathSeparator(t.charCodeAt(l));++l);if(l<e&&l!==a){const f=t.slice(a,l);for(a=l;l<e&&isPathSeparator(t.charCodeAt(l));++l);if(l<e&&l!==a){for(a=l;l<e&&!isPathSeparator(t.charCodeAt(l));++l);if(l===e)return`\\\\${f}\\${t.slice(a)}\\`;l!==a&&(r=`\\\\${f}\\${t.slice(a,l)}`,i=l)}}}else i=1;else isWindowsDeviceRoot(s)&&t.charCodeAt(1)===58&&(r=t.slice(0,2),i=2,e>2&&isPathSeparator(t.charCodeAt(2))&&(n=!0,i=3));else if(isPathSeparator(s))return"\\";let o;return i<e?o=normalizeString(t.slice(i),!n,"\\",isPathSeparator):o="",o.length===0&&!n&&(o="."),o.length>0&&isPathSeparator(t.charCodeAt(e-1))&&(o+="\\"),r===void 0?n?o.length>0?`\\${o}`:"\\":o.length>0?o:"":n?o.length>0?`${r}\\${o}`:`${r}\\`:o.length>0?r+o:r}function isAbsolute(t){assertPath(t);const e=t.length;if(e===0)return!1;const i=t.charCodeAt(0);return isPathSeparator(i)?!0:!!(isWindowsDeviceRoot(i)&&e>2&&t.charCodeAt(1)===58&&isPathSeparator(t.charCodeAt(2)))}function join(...t){const e=t.length;if(e===0)return".";let i,r=null;for(let o=0;o<e;++o){const l=t[o];assertPath(l),l.length>0&&(i===void 0?i=r=l:i+=`\\${l}`)}if(i===void 0)return".";let n=!0,s=0;if(assert(r!=null),isPathSeparator(r.charCodeAt(0))){++s;const o=r.length;o>1&&isPathSeparator(r.charCodeAt(1))&&(++s,o>2&&(isPathSeparator(r.charCodeAt(2))?++s:n=!1))}if(n){for(;s<i.length&&isPathSeparator(i.charCodeAt(s));++s);s>=2&&(i=`\\${i.slice(s)}`)}return normalize(i)}function relative(t,e){if(assertPath(t),assertPath(e),t===e)return"";const i=resolve(t),r=resolve(e);if(i===r||(t=i.toLowerCase(),e=r.toLowerCase(),t===e))return"";let n=0,s=t.length;for(;n<s&&t.charCodeAt(n)===92;++n);for(;s-1>n&&t.charCodeAt(s-1)===92;--s);const o=s-n;let l=0,a=e.length;for(;l<a&&e.charCodeAt(l)===92;++l);for(;a-1>l&&e.charCodeAt(a-1)===92;--a);const f=a-l,c=o<f?o:f;let h=-1,u=0;for(;u<=c;++u){if(u===c){if(f>c){if(e.charCodeAt(l+u)===92)return r.slice(l+u+1);if(u===2)return r.slice(l+u)}o>c&&(t.charCodeAt(n+u)===92?h=u:u===2&&(h=3));break}const w=t.charCodeAt(n+u),A=e.charCodeAt(l+u);if(w!==A)break;w===92&&(h=u)}if(u!==c&&h===-1)return r;let E="";for(h===-1&&(h=0),u=n+h+1;u<=s;++u)(u===s||t.charCodeAt(u)===92)&&(E.length===0?E+="..":E+="\\..");return E.length>0?E+r.slice(l+h,a):(l+=h,r.charCodeAt(l)===92&&++l,r.slice(l,a))}function toNamespacedPath(t){if(typeof t!="string")return t;if(t.length===0)return"";const e=resolve(t);if(e.length>=3){if(e.charCodeAt(0)===92){if(e.charCodeAt(1)===92){const i=e.charCodeAt(2);if(i!==63&&i!==46)return`\\\\?\\UNC\\${e.slice(2)}`}}else if(isWindowsDeviceRoot(e.charCodeAt(0))&&e.charCodeAt(1)===58&&e.charCodeAt(2)===92)return`\\\\?\\${e}`}return t}function dirname(t){assertPath(t);const e=t.length;if(e===0)return".";let i=-1,r=-1,n=!0,s=0;const o=t.charCodeAt(0);if(e>1)if(isPathSeparator(o)){if(i=s=1,isPathSeparator(t.charCodeAt(1))){let l=2,a=l;for(;l<e&&!isPathSeparator(t.charCodeAt(l));++l);if(l<e&&l!==a){for(a=l;l<e&&isPathSeparator(t.charCodeAt(l));++l);if(l<e&&l!==a){for(a=l;l<e&&!isPathSeparator(t.charCodeAt(l));++l);if(l===e)return t;l!==a&&(i=s=l+1)}}}}else isWindowsDeviceRoot(o)&&t.charCodeAt(1)===58&&(i=s=2,e>2&&isPathSeparator(t.charCodeAt(2))&&(i=s=3));else if(isPathSeparator(o))return t;for(let l=e-1;l>=s;--l)if(isPathSeparator(t.charCodeAt(l))){if(!n){r=l;break}}else n=!1;if(r===-1){if(i===-1)return".";r=i}return t.slice(0,r)}function basename(t,e=""){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');assertPath(t);let i=0,r=-1,n=!0,s;if(t.length>=2){const o=t.charCodeAt(0);isWindowsDeviceRoot(o)&&t.charCodeAt(1)===58&&(i=2)}if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,l=-1;for(s=t.length-1;s>=i;--s){const a=t.charCodeAt(s);if(isPathSeparator(a)){if(!n){i=s+1;break}}else l===-1&&(n=!1,l=s+1),o>=0&&(a===e.charCodeAt(o)?--o==-1&&(r=s):(o=-1,r=l))}return i===r?r=l:r===-1&&(r=t.length),t.slice(i,r)}else{for(s=t.length-1;s>=i;--s)if(isPathSeparator(t.charCodeAt(s))){if(!n){i=s+1;break}}else r===-1&&(n=!1,r=s+1);return r===-1?"":t.slice(i,r)}}function extname(t){assertPath(t);let e=0,i=-1,r=0,n=-1,s=!0,o=0;t.length>=2&&t.charCodeAt(1)===58&&isWindowsDeviceRoot(t.charCodeAt(0))&&(e=r=2);for(let l=t.length-1;l>=e;--l){const a=t.charCodeAt(l);if(isPathSeparator(a)){if(!s){r=l+1;break}continue}n===-1&&(s=!1,n=l+1),a===46?i===-1?i=l:o!==1&&(o=1):i!==-1&&(o=-1)}return i===-1||n===-1||o===0||o===1&&i===n-1&&i===r+1?"":t.slice(i,n)}function format(t){if(t===null||typeof t!="object")throw new TypeError(`The "pathObject" argument must be of type Object. Received type ${typeof t}`);return _format("\\",t)}function parse(t){assertPath(t);const e={root:"",dir:"",base:"",ext:"",name:""},i=t.length;if(i===0)return e;let r=0,n=t.charCodeAt(0);if(i>1){if(isPathSeparator(n)){if(r=1,isPathSeparator(t.charCodeAt(1))){let h=2,u=h;for(;h<i&&!isPathSeparator(t.charCodeAt(h));++h);if(h<i&&h!==u){for(u=h;h<i&&isPathSeparator(t.charCodeAt(h));++h);if(h<i&&h!==u){for(u=h;h<i&&!isPathSeparator(t.charCodeAt(h));++h);h===i?r=h:h!==u&&(r=h+1)}}}}else if(isWindowsDeviceRoot(n)&&t.charCodeAt(1)===58)if(r=2,i>2){if(isPathSeparator(t.charCodeAt(2))){if(i===3)return e.root=e.dir=t,e;r=3}}else return e.root=e.dir=t,e}else if(isPathSeparator(n))return e.root=e.dir=t,e;r>0&&(e.root=t.slice(0,r));let s=-1,o=r,l=-1,a=!0,f=t.length-1,c=0;for(;f>=r;--f){if(n=t.charCodeAt(f),isPathSeparator(n)){if(!a){o=f+1;break}continue}l===-1&&(a=!1,l=f+1),n===46?s===-1?s=f:c!==1&&(c=1):s!==-1&&(c=-1)}return s===-1||l===-1||c===0||c===1&&s===l-1&&s===o+1?l!==-1&&(e.base=e.name=t.slice(o,l)):(e.name=t.slice(o,s),e.base=t.slice(o,l),e.ext=t.slice(s,l)),o>0&&o!==r?e.dir=t.slice(0,o-1):e.dir=e.root,e}function fromFileUrl(t){if(t=t instanceof URL?t:new URL(t),t.protocol!="file:")throw new TypeError("Must be a file URL.");let e=decodeURIComponent(t.pathname.replace(/\//g,"\\").replace(/%(?![0-9A-Fa-f]{2})/g,"%25")).replace(/^\\*([A-Za-z]:)(\\|$)/,"$1\\");return t.hostname!=""&&(e=`\\\\${t.hostname}${e}`),e}function toFileUrl(t){if(!isAbsolute(t))throw new TypeError("Must be an absolute path.");const[,e,i]=t.match(/^(?:[/\\]{2}([^/\\]+)(?=[/\\](?:[^/\\]|$)))?(.*)/),r=new URL("file:///");if(r.pathname=encodeWhitespace(i.replace(/%/g,"%25")),e!=null&&e!="localhost"&&(r.hostname=e,!r.hostname))throw new TypeError("Invalid hostname.");return r}const mod={sep,delimiter,resolve,normalize,isAbsolute,join,relative,toNamespacedPath,dirname,basename,extname,format,parse,fromFileUrl,toFileUrl},sep1="/",delimiter1=":";function resolve1(...t){let e="",i=!1;for(let r=t.length-1;r>=-1&&!i;r--){let n;if(r>=0)n=t[r];else{const{Deno:s}=globalThis;if(typeof s?.cwd!="function")throw new TypeError("Resolved a relative path without a CWD.");n=s.cwd()}assertPath(n),n.length!==0&&(e=`${n}/${e}`,i=n.charCodeAt(0)===CHAR_FORWARD_SLASH)}return e=normalizeString(e,!i,"/",isPosixPathSeparator),i?e.length>0?`/${e}`:"/":e.length>0?e:"."}function normalize1(t){if(assertPath(t),t.length===0)return".";const e=t.charCodeAt(0)===47,i=t.charCodeAt(t.length-1)===47;return t=normalizeString(t,!e,"/",isPosixPathSeparator),t.length===0&&!e&&(t="."),t.length>0&&i&&(t+="/"),e?`/${t}`:t}function isAbsolute1(t){return assertPath(t),t.length>0&&t.charCodeAt(0)===47}function join1(...t){if(t.length===0)return".";let e;for(let i=0,r=t.length;i<r;++i){const n=t[i];assertPath(n),n.length>0&&(e?e+=`/${n}`:e=n)}return e?normalize1(e):"."}function relative1(t,e){if(assertPath(t),assertPath(e),t===e||(t=resolve1(t),e=resolve1(e),t===e))return"";let i=1;const r=t.length;for(;i<r&&t.charCodeAt(i)===47;++i);const n=r-i;let s=1;const o=e.length;for(;s<o&&e.charCodeAt(s)===47;++s);const l=o-s,a=n<l?n:l;let f=-1,c=0;for(;c<=a;++c){if(c===a){if(l>a){if(e.charCodeAt(s+c)===47)return e.slice(s+c+1);if(c===0)return e.slice(s+c)}else n>a&&(t.charCodeAt(i+c)===47?f=c:c===0&&(f=0));break}const u=t.charCodeAt(i+c),E=e.charCodeAt(s+c);if(u!==E)break;u===47&&(f=c)}let h="";for(c=i+f+1;c<=r;++c)(c===r||t.charCodeAt(c)===47)&&(h.length===0?h+="..":h+="/..");return h.length>0?h+e.slice(s+f):(s+=f,e.charCodeAt(s)===47&&++s,e.slice(s))}function toNamespacedPath1(t){return t}function dirname1(t){if(assertPath(t),t.length===0)return".";const e=t.charCodeAt(0)===47;let i=-1,r=!0;for(let n=t.length-1;n>=1;--n)if(t.charCodeAt(n)===47){if(!r){i=n;break}}else r=!1;return i===-1?e?"/":".":e&&i===1?"//":t.slice(0,i)}function basename1(t,e=""){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');assertPath(t);let i=0,r=-1,n=!0,s;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,l=-1;for(s=t.length-1;s>=0;--s){const a=t.charCodeAt(s);if(a===47){if(!n){i=s+1;break}}else l===-1&&(n=!1,l=s+1),o>=0&&(a===e.charCodeAt(o)?--o==-1&&(r=s):(o=-1,r=l))}return i===r?r=l:r===-1&&(r=t.length),t.slice(i,r)}else{for(s=t.length-1;s>=0;--s)if(t.charCodeAt(s)===47){if(!n){i=s+1;break}}else r===-1&&(n=!1,r=s+1);return r===-1?"":t.slice(i,r)}}function extname1(t){assertPath(t);let e=-1,i=0,r=-1,n=!0,s=0;for(let o=t.length-1;o>=0;--o){const l=t.charCodeAt(o);if(l===47){if(!n){i=o+1;break}continue}r===-1&&(n=!1,r=o+1),l===46?e===-1?e=o:s!==1&&(s=1):e!==-1&&(s=-1)}return e===-1||r===-1||s===0||s===1&&e===r-1&&e===i+1?"":t.slice(e,r)}function format1(t){if(t===null||typeof t!="object")throw new TypeError(`The "pathObject" argument must be of type Object. Received type ${typeof t}`);return _format("/",t)}function parse1(t){assertPath(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;const i=t.charCodeAt(0)===47;let r;i?(e.root="/",r=1):r=0;let n=-1,s=0,o=-1,l=!0,a=t.length-1,f=0;for(;a>=r;--a){const c=t.charCodeAt(a);if(c===47){if(!l){s=a+1;break}continue}o===-1&&(l=!1,o=a+1),c===46?n===-1?n=a:f!==1&&(f=1):n!==-1&&(f=-1)}return n===-1||o===-1||f===0||f===1&&n===o-1&&n===s+1?o!==-1&&(s===0&&i?e.base=e.name=t.slice(1,o):e.base=e.name=t.slice(s,o)):(s===0&&i?(e.name=t.slice(1,n),e.base=t.slice(1,o)):(e.name=t.slice(s,n),e.base=t.slice(s,o)),e.ext=t.slice(n,o)),s>0?e.dir=t.slice(0,s-1):i&&(e.dir="/"),e}function fromFileUrl1(t){if(t=t instanceof URL?t:new URL(t),t.protocol!="file:")throw new TypeError("Must be a file URL.");return decodeURIComponent(t.pathname.replace(/%(?![0-9A-Fa-f]{2})/g,"%25"))}function toFileUrl1(t){if(!isAbsolute1(t))throw new TypeError("Must be an absolute path.");const e=new URL("file:///");return e.pathname=encodeWhitespace(t.replace(/%/g,"%25").replace(/\\/g,"%5C")),e}const mod1={sep:sep1,delimiter:delimiter1,resolve:resolve1,normalize:normalize1,isAbsolute:isAbsolute1,join:join1,relative:relative1,toNamespacedPath:toNamespacedPath1,dirname:dirname1,basename:basename1,extname:extname1,format:format1,parse:parse1,fromFileUrl:fromFileUrl1,toFileUrl:toFileUrl1},SEP=isWindows?"\\":"/",SEP_PATTERN=isWindows?/[\\/]+/:/\/+/;function common(t,e=SEP){const[i="",...r]=t;if(i===""||r.length===0)return i.substring(0,i.lastIndexOf(e)+1);const n=i.split(e);let s=n.length;for(const l of r){const a=l.split(e);for(let f=0;f<s;f++)a[f]!==n[f]&&(s=f);if(s===0)return""}const o=n.slice(0,s).join(e);return o.endsWith(e)?o:`${o}${e}`}const path=isWindows?mod:mod1,{join:join2,normalize:normalize2}=path,regExpEscapeChars=["!","$","(",")","*","+",".","=","?","[","\\","^","{","|"],rangeEscapeChars=["-","\\","]"];function globToRegExp(t,{extended:e=!0,globstar:i=!0,os:r=osType,caseInsensitive:n=!1}={}){if(t=="")return/(?!)/;const s=r=="windows"?"(?:\\\\|/)+":"/+",o=r=="windows"?"(?:\\\\|/)*":"/*",l=r=="windows"?["\\","/"]:["/"],a=r=="windows"?"(?:[^\\\\/]*(?:\\\\|/|$)+)*":"(?:[^/]*(?:/|$)+)*",f=r=="windows"?"[^\\\\/]*":"[^/]*",c=r=="windows"?"`":"\\";let h=t.length;for(;h>1&&l.includes(t[h-1]);h--);t=t.slice(0,h);let u="";for(let E=0;E<t.length;){let w="";const A=[];let T=!1,_=!1,g=!1,d=E;for(;d<t.length&&!l.includes(t[d]);d++){if(_){_=!1,w+=(T?rangeEscapeChars:regExpEscapeChars).includes(t[d])?`\\${t[d]}`:t[d];continue}if(t[d]==c){_=!0;continue}if(t[d]=="[")if(T){if(t[d+1]==":"){let y=d+1,L="";for(;t[y+1]!=null&&t[y+1]!=":";)L+=t[y+1],y++;if(t[y+1]==":"&&t[y+2]=="]"){d=y+2,L=="alnum"?w+="\\dA-Za-z":L=="alpha"?w+="A-Za-z":L=="ascii"?w+="\0-\x7F":L=="blank"?w+="	 ":L=="cntrl"?w+="\0-\x7F":L=="digit"?w+="\\d":L=="graph"?w+="!-~":L=="lower"?w+="a-z":L=="print"?w+=" -~":L=="punct"?w+=`!"#$%&'()*+,\\-./:;<=>?@[\\\\\\]^_\u2018{|}~`:L=="space"?w+="\\s\v":L=="upper"?w+="A-Z":L=="word"?w+="\\w":L=="xdigit"&&(w+="\\dA-Fa-f");continue}}}else{T=!0,w+="[",t[d+1]=="!"?(d++,w+="^"):t[d+1]=="^"&&(d++,w+="\\^");continue}if(t[d]=="]"&&T){T=!1,w+="]";continue}if(T){t[d]=="\\"?w+="\\\\":w+=t[d];continue}if(t[d]==")"&&A.length>0&&A[A.length-1]!="BRACE"){w+=")";const y=A.pop();y=="!"?w+=f:y!="@"&&(w+=y);continue}if(t[d]=="|"&&A.length>0&&A[A.length-1]!="BRACE"){w+="|";continue}if(t[d]=="+"&&e&&t[d+1]=="("){d++,A.push("+"),w+="(?:";continue}if(t[d]=="@"&&e&&t[d+1]=="("){d++,A.push("@"),w+="(?:";continue}if(t[d]=="?"){e&&t[d+1]=="("?(d++,A.push("?"),w+="(?:"):w+=".";continue}if(t[d]=="!"&&e&&t[d+1]=="("){d++,A.push("!"),w+="(?!";continue}if(t[d]=="{"){A.push("BRACE"),w+="(?:";continue}if(t[d]=="}"&&A[A.length-1]=="BRACE"){A.pop(),w+=")";continue}if(t[d]==","&&A[A.length-1]=="BRACE"){w+="|";continue}if(t[d]=="*"){if(e&&t[d+1]=="(")d++,A.push("*"),w+="(?:";else{const y=t[d-1];let L=1;for(;t[d+1]=="*";)d++,L++;const I=t[d+1];i&&L==2&&[...l,void 0].includes(y)&&[...l,void 0].includes(I)?(w+=a,g=!0):w+=f}continue}w+=regExpEscapeChars.includes(t[d])?`\\${t[d]}`:t[d]}if(A.length>0||T||_){w="";for(const y of t.slice(E,d))w+=regExpEscapeChars.includes(y)?`\\${y}`:y,g=!1}for(u+=w,g||(u+=d<t.length?s:o,g=!0);l.includes(t[d]);)d++;if(!(d>E))throw new Error("Assertion failure: i > j (potential infinite loop)");E=d}return u=`^${u}$`,new RegExp(u,n?"i":"")}function isGlob(t){const e={"{":"}","(":")","[":"]"},i=/\\(.)|(^!|\*|\?|[\].+)]\?|\[[^\\\]]+\]|\{[^\\}]+\}|\(\?[:!=][^\\)]+\)|\([^|]+\|[^\\)]+\))/;if(t==="")return!1;let r;for(;r=i.exec(t);){if(r[2])return!0;let n=r.index+r[0].length;const s=r[1],o=s?e[s]:null;if(s&&o){const l=t.indexOf(o,n);l!==-1&&(n=l+1)}t=t.slice(n)}return!1}function normalizeGlob(t,{globstar:e=!1}={}){if(t.match(/\0/g))throw new Error(`Glob contains invalid characters: "${t}"`);if(!e)return normalize2(t);const i=SEP_PATTERN.source,r=new RegExp(`(?<=(${i}|^)\\*\\*${i})\\.\\.(?=${i}|$)`,"g");return normalize2(t.replace(r,"\0")).replace(/\0/g,"..")}function joinGlobs(t,{extended:e=!1,globstar:i=!1}={}){if(!i||t.length==0)return join2(...t);if(t.length===0)return".";let r;for(const n of t){const s=n;s.length>0&&(r?r+=`${SEP}${s}`:r=s)}return r?normalizeGlob(r,{extended:e,globstar:i}):"."}const path1=isWindows?mod:mod1,{basename:basename2,delimiter:delimiter2,dirname:dirname2,extname:extname2,format:format2,fromFileUrl:fromFileUrl2,isAbsolute:isAbsolute2,join:join3,normalize:normalize3,parse:parse2,relative:relative2,resolve:resolve2,sep:sep2,toFileUrl:toFileUrl2,toNamespacedPath:toNamespacedPath2}=path1,mod2={SEP,SEP_PATTERN,win32:mod,posix:mod1,basename:basename2,delimiter:delimiter2,dirname:dirname2,extname:extname2,format:format2,fromFileUrl:fromFileUrl2,isAbsolute:isAbsolute2,join:join3,normalize:normalize3,parse:parse2,relative:relative2,resolve:resolve2,sep:sep2,toFileUrl:toFileUrl2,toNamespacedPath:toNamespacedPath2,common,globToRegExp,isGlob,normalizeGlob,joinGlobs};function isString(t){return typeof t=="string"}function isArray(t,e){return Array.isArray(t)&&(!e||t.every(e))}function isObject(t,e){return isNone(t)||isArray(t)?!1:typeof t=="object"&&(!e||Object.values(t).every(e))}function isNone(t){return t==null}class EnsureError extends Error{constructor(e){super(e);Error.captureStackTrace&&Error.captureStackTrace(this,EnsureError),this.name="EnsureError"}}function ensure(t,e,i="The value is not expected type"){if(!e(t))throw new EnsureError(i)}function ensureString(t){return ensure(t,isString,"The value must be string")}function ensureObject(t,e){return ensure(t,r=>isObject(r,e),"The value must be object")}function deferred(){let t;const e=new Promise((i,r)=>{t={resolve:i,reject:r}});return Object.assign(e,t)}class Lock{#e;constructor(){this.#e=[]}async with(e){await this.acquire();try{await(e()??Promise.resolve())}finally{this.release()}}async acquire(){const e=[...this.#e];return this.#e.push(deferred()),e.length&&await Promise.all(e),!0}release(){const e=this.#e.shift();if(e)e.resolve();else throw new Error("The lock is not locked")}locked(){return!!this.#e.length}}class Event{#e;constructor(){this.#e=deferred()}async wait(){return this.#e&&await this.#e,!0}set(){this.#e&&(this.#e.resolve(),this.#e=null)}clear(){this.#e||(this.#e=deferred())}is_set(){return!this.#e}}class Condition{#e;#t;constructor(e){this.#e=e??new Lock,this.#t=[]}async with(e){await this.acquire();try{await(e()??Promise.resolve())}finally{this.release()}}async acquire(){return await this.#e.acquire(),!0}release(){this.#e.release()}locked(){return this.#e.locked()}notify(e=1){if(!this.locked())throw new Error("The lock is not acquired");for(const i of Array(e)){const r=this.#t.shift();if(!r)break;r.set()}}notify_all(){this.notify(this.#t.length)}async wait(){if(!this.locked())throw new Error("The lock is not acquired");const e=new Event;return this.#t.push(e),this.release(),await e.wait(),await this.acquire(),!0}async wait_for(e){for(;!e();)await this.wait()}}class QueueEmpty extends Error{}class QueueFull extends Error{}class Queue{#e;#t;#r;#i;constructor(e=0){this.#e=[],this.#t=e<=0?0:e,this.#r=new Condition,this.#i=new Condition}empty(){return!this.#e.length}full(){return!!this.#t&&this.#e.length===this.#t}async get(){const e=this.#e.shift();return e?(await this.#r.with(()=>{this.#r.notify()}),e):new Promise(i=>{this.#i.with(async()=>{await this.#i.wait_for(()=>!!this.#e.length),i(await this.get())})})}get_nowait(){const e=this.#e.shift();if(!e)throw new QueueEmpty("Queue empty");return this.#r.with(()=>{this.#r.notify()}),e}async put(e){if(this.#t&&this.#e.length>=this.#t){await this.#r.with(async()=>{await this.#r.wait_for(()=>this.#e.length<this.#t),await this.put(e)});return}await this.#i.with(()=>{this.#i.notify()}),this.#e.push(e)}put_nowait(e){if(this.#t&&this.#e.length>=this.#t)throw new QueueFull("Queue full");this.#i.with(()=>{this.#i.notify()}),this.#e.push(e)}qsize(){return this.#e.length}}function deferred1(){let t,e="pending";const i=new Promise((r,n)=>{t={async resolve(s){await s,e="fulfilled",r(s)},reject(s){e="rejected",n(s)}}});return Object.defineProperty(i,"state",{get:()=>e}),Object.assign(i,t)}const semver=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,indexOrEnd=(t,e)=>t.indexOf(e)===-1?t.length:t.indexOf(e),split=t=>{const e=t.replace(/^v/,"").replace(/\+.*$/,""),i=indexOrEnd(e,"-"),r=e.substring(0,i).split(".");return r.push(e.substring(i+1)),r},tryParse=t=>isNaN(Number(t))?t:Number(t),validate=t=>{if(typeof t!="string")throw new TypeError("Invalid argument expected string");if(!semver.test(t))throw new Error("Invalid argument not valid semver ('"+t+"' received)")},compareVersions=(t,e)=>{[t,e].forEach(validate);const i=split(t),r=split(e);for(let o=0;o<Math.max(i.length-1,r.length-1);o++){const l=parseInt(i[o]||"0",10),a=parseInt(r[o]||"0",10);if(l>a)return 1;if(a>l)return-1}const n=i[i.length-1],s=r[r.length-1];if(n&&s){const o=n.split(".").map(tryParse),l=s.split(".").map(tryParse);for(let a=0;a<Math.max(o.length,l.length);a++){if(o[a]===void 0||typeof l[a]=="string"&&typeof o[a]=="number")return-1;if(l[a]===void 0||typeof o[a]=="string"&&typeof l[a]=="number"||o[a]>l[a])return 1;if(l[a]>o[a])return-1}}else if(n||s)return n?-1:1;return 0},allowedOperators=[">",">=","=","<","<="],operatorResMap={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]},validateOperator=t=>{if(typeof t!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof t);if(allowedOperators.indexOf(t)===-1)throw new TypeError("Invalid operator, expected one of "+allowedOperators.join("|"))};compareVersions.validate=t=>typeof t=="string"&&semver.test(t),compareVersions.compare=(t,e,i)=>{validateOperator(i);const r=compareVersions(t,e);return operatorResMap[i].indexOf(r)>-1};class WorkerReader{#e;#t;#r;#i;#n;constructor(e){this.#e=new Queue,this.#t=new Uint8Array,this.#r=!1,this.#i=deferred1(),this.#n=e,this.#n.onmessage=i=>{this.#e&&!this.#r&&this.#e.put_nowait(i.data)}}async read(e){if(this.#t.length)return this.readFromRemain(e);if(!this.#e||this.#r&&this.#e.empty())return this.#e=void 0,null;if(!this.#e?.empty())return this.#t=this.#e.get_nowait(),this.readFromRemain(e);const i=await Promise.race([this.#e.get(),this.#i]);return i==null?await this.read(e):(this.#t=i,this.readFromRemain(e))}readFromRemain(e){const i=e.byteLength,r=this.#t.subarray(0,i);return this.#t=this.#t.subarray(i),e.set(r),r.byteLength}close(){this.#r=!0,this.#i.resolve()}}const supportTransfer=compareVersions(Deno.version.deno,"1.14.0")>=0;class WorkerWriter{#e;constructor(e){this.#e=e}write(e){if(supportTransfer){const i=new Uint8Array(e);this.#e.postMessage(i,[i.buffer])}else this.#e.postMessage(e);return Promise.resolve(e.length)}}function utf8Count(t){const e=t.length;let i=0,r=0;for(;r<e;){let n=t.charCodeAt(r++);if((n&4294967168)==0){i++;continue}else if((n&4294965248)==0)i+=2;else{if(n>=55296&&n<=56319&&r<e){const s=t.charCodeAt(r);(s&64512)==56320&&(++r,n=((n&1023)<<10)+(s&1023)+65536)}(n&4294901760)==0?i+=3:i+=4}}return i}function utf8EncodeJs(t,e,i){const r=t.length;let n=i,s=0;for(;s<r;){let o=t.charCodeAt(s++);if((o&4294967168)==0){e[n++]=o;continue}else if((o&4294965248)==0)e[n++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<r){const l=t.charCodeAt(s);(l&64512)==56320&&(++s,o=((o&1023)<<10)+(l&1023)+65536)}(o&4294901760)==0?(e[n++]=o>>12&15|224,e[n++]=o>>6&63|128):(e[n++]=o>>18&7|240,e[n++]=o>>12&63|128,e[n++]=o>>6&63|128)}e[n++]=o&63|128}}const sharedTextEncoder=new TextEncoder;function utf8EncodeTEencodeInto(t,e,i){sharedTextEncoder.encodeInto(t,e.subarray(i))}const utf8EncodeTE=utf8EncodeTEencodeInto;function utf8DecodeJs(t,e,i){let r=e;const n=r+i,s=[];let o="";for(;r<n;){const l=t[r++];if((l&128)==0)s.push(l);else if((l&224)==192){const a=t[r++]&63;s.push((l&31)<<6|a)}else if((l&240)==224){const a=t[r++]&63,f=t[r++]&63;s.push((l&31)<<12|a<<6|f)}else if((l&248)==240){const a=t[r++]&63,f=t[r++]&63,c=t[r++]&63;let h=(l&7)<<18|a<<12|f<<6|c;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(l);s.length>=4096&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const sharedTextDecoder=new TextDecoder;function utf8DecodeTD(t,e,i){const r=t.subarray(e,e+i);return sharedTextDecoder.decode(r)}class ExtData{type;data;constructor(e,i){this.type=e,this.data=i}}function setUint64(t,e,i){const r=i/4294967296,n=i;t.setUint32(e,r),t.setUint32(e+4,n)}function setInt64(t,e,i){const r=Math.floor(i/4294967296),n=i;t.setUint32(e,r),t.setUint32(e+4,n)}function getInt64(t,e){const i=t.getInt32(e),r=t.getUint32(e+4);return i*4294967296+r}function getUint64(t,e){const i=t.getUint32(e),r=t.getUint32(e+4);return i*4294967296+r}const EXT_TIMESTAMP=-1,TIMESTAMP32_MAX_SEC=4294967296-1,TIMESTAMP64_MAX_SEC=17179869184-1;function encodeTimeSpecToTimestamp({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=TIMESTAMP64_MAX_SEC)if(e===0&&t<=TIMESTAMP32_MAX_SEC){const i=new Uint8Array(4);return new DataView(i.buffer).setUint32(0,t),i}else{const i=t/4294967296,r=t&4294967295,n=new Uint8Array(8),s=new DataView(n.buffer);return s.setUint32(0,e<<2|i&3),s.setUint32(4,r),n}else{const i=new Uint8Array(12),r=new DataView(i.buffer);return r.setUint32(0,e),setInt64(r,4,t),i}}function encodeDateToTimeSpec(t){const e=t.getTime(),i=Math.floor(e/1e3),r=(e-i*1e3)*1e6,n=Math.floor(r/1e9);return{sec:i+n,nsec:r-n*1e9}}function encodeTimestampExtension(t){if(t instanceof Date){const e=encodeDateToTimeSpec(t);return encodeTimeSpecToTimestamp(e)}else return null}function decodeTimestampToTimeSpec(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const i=e.getUint32(0),r=e.getUint32(4),n=(i&3)*4294967296+r,s=i>>>2;return{sec:n,nsec:s}}case 12:{const i=getInt64(e,4),r=e.getUint32(0);return{sec:i,nsec:r}}default:throw new Error(`Unrecognized data size for timestamp: ${t.length}`)}}function decodeTimestampExtension(t){const e=decodeTimestampToTimeSpec(t);return new Date(e.sec*1e3+e.nsec/1e6)}const timestampExtension={type:EXT_TIMESTAMP,encode:encodeTimestampExtension,decode:decodeTimestampExtension};class ExtensionCodec{static defaultCodec=new ExtensionCodec;__brand;builtInEncoders=[];builtInDecoders=[];encoders=[];decoders=[];constructor(){this.register(timestampExtension)}register({type:e,encode:i,decode:r}){if(e>=0)this.encoders[e]=i,this.decoders[e]=r;else{const n=1+e;this.builtInEncoders[n]=i,this.builtInDecoders[n]=r}}tryToEncode(e,i){for(let r=0;r<this.builtInEncoders.length;r++){const n=this.builtInEncoders[r];if(n!=null){const s=n(e,i);if(s!=null){const o=-1-r;return new ExtData(o,s)}}}for(let r=0;r<this.encoders.length;r++){const n=this.encoders[r];if(n!=null){const s=n(e,i);if(s!=null){const o=r;return new ExtData(o,s)}}}return e instanceof ExtData?e:null}decode(e,i,r){const n=i<0?this.builtInDecoders[-1-i]:this.decoders[i];return n?n(e,i,r):new ExtData(i,e)}}function ensureUint8Array(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new Uint8Array(t):Uint8Array.from(t)}function createDataView(t){if(t instanceof ArrayBuffer)return new DataView(t);const e=ensureUint8Array(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}class Encoder{extensionCodec;context;maxDepth;initialBufferSize;sortKeys;forceFloat32;ignoreUndefined;pos=0;view;bytes;constructor(e=ExtensionCodec.defaultCodec,i=void 0,r=100,n=2048,s=!1,o=!1,l=!1){this.extensionCodec=e,this.context=i,this.maxDepth=r,this.initialBufferSize=n,this.sortKeys=s,this.forceFloat32=o,this.ignoreUndefined=l,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}getUint8Array(){return this.bytes.subarray(0,this.pos)}reinitializeState(){this.pos=0}encode(e){return this.reinitializeState(),this.doEncode(e,1),this.getUint8Array()}doEncode(e,i){if(i>this.maxDepth)throw new Error(`Too deep objects in depth ${i}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.encodeObject(e,i)}ensureBufferSizeToWrite(e){const i=this.pos+e;this.view.byteLength<i&&this.resizeBuffer(i*2)}resizeBuffer(e){const i=new ArrayBuffer(e),r=new Uint8Array(i),n=new DataView(i);r.set(this.bytes),this.view=n,this.bytes=r}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=1+4;if(e.length>200){const n=utf8Count(e);this.ensureBufferSizeToWrite(i+n),this.writeStringHeader(n),utf8EncodeTE(e,this.bytes,this.pos),this.pos+=n}else{const n=utf8Count(e);this.ensureBufferSizeToWrite(i+n),this.writeStringHeader(n),utf8EncodeJs(e,this.bytes,this.pos),this.pos+=n}}encodeObject(e,i){const r=this.extensionCodec.tryToEncode(e,this.context);if(r!=null)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,i);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,i);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const i=e.byteLength;if(i<256)this.writeU8(196),this.writeU8(i);else if(i<65536)this.writeU8(197),this.writeU16(i);else if(i<4294967296)this.writeU8(198),this.writeU32(i);else throw new Error(`Too large binary: ${i}`);const r=ensureUint8Array(e);this.writeU8a(r)}encodeArray(e,i){const r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw new Error(`Too large array: ${r}`);for(const n of e)this.doEncode(n,i+1)}countWithoutUndefined(e,i){let r=0;for(const n of i)e[n]!==void 0&&r++;return r}encodeMap(e,i){const r=Object.keys(e);this.sortKeys&&r.sort();const n=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else if(n<4294967296)this.writeU8(223),this.writeU32(n);else throw new Error(`Too large map object: ${n}`);for(const s of r){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,i+1))}}encodeExtension(e){const i=e.data.length;if(i===1)this.writeU8(212);else if(i===2)this.writeU8(213);else if(i===4)this.writeU8(214);else if(i===8)this.writeU8(215);else if(i===16)this.writeU8(216);else if(i<256)this.writeU8(199),this.writeU8(i);else if(i<65536)this.writeU8(200),this.writeU16(i);else if(i<4294967296)this.writeU8(201),this.writeU32(i);else throw new Error(`Too large extension object: ${i}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const i=e.length;this.ensureBufferSizeToWrite(i),this.bytes.set(e,this.pos),this.pos+=i}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),setUint64(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),setInt64(this.view,this.pos,e),this.pos+=8}}const defaultEncodeOptions={};function encode1(t,e=defaultEncodeOptions){return new Encoder(e.extensionCodec,e.context,e.maxDepth,e.initialBufferSize,e.sortKeys,e.forceFloat32,e.ignoreUndefined).encode(t)}function prettyByte(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}class CachedKeyDecoder{maxKeyLength;maxLengthPerKey;hit=0;miss=0;caches;constructor(e=16,i=16){this.maxKeyLength=e,this.maxLengthPerKey=i,this.caches=[];for(let r=0;r<this.maxKeyLength;r++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}get(e,i,r){const n=this.caches[r-1],s=n.length;e:for(let o=0;o<s;o++){const l=n[o],a=l.bytes;for(let f=0;f<r;f++)if(a[f]!==e[i+f])continue e;return l.value}return null}store(e,i){const r=this.caches[e.length-1],n={bytes:e,value:i};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=n:r.push(n)}decode(e,i,r){const n=this.get(e,i,r);if(n!=null)return this.hit++,n;this.miss++;const s=utf8DecodeJs(e,i,r),o=Uint8Array.prototype.slice.call(e,i,i+r);return this.store(o,s),s}}var State;(function(t){t[t.ARRAY=0]="ARRAY",t[t.MAP_KEY=1]="MAP_KEY",t[t.MAP_VALUE=2]="MAP_VALUE"})(State||(State={}));const isValidMapKeyType=t=>{const e=typeof t;return e==="string"||e==="number"},HEAD_BYTE_REQUIRED=-1,EMPTY_VIEW=new DataView(new ArrayBuffer(0)),EMPTY_BYTES=new Uint8Array(EMPTY_VIEW.buffer),DataViewIndexOutOfBoundsError=(()=>{try{EMPTY_VIEW.getInt8(0)}catch(t){return t.constructor}throw new Error("never reached")})(),MORE_DATA=new DataViewIndexOutOfBoundsError("Insufficient data"),sharedCachedKeyDecoder=new CachedKeyDecoder;class Decoder{extensionCodec;context;maxStrLength;maxBinLength;maxArrayLength;maxMapLength;maxExtLength;keyDecoder;totalPos=0;pos=0;view=EMPTY_VIEW;bytes=EMPTY_BYTES;headByte=HEAD_BYTE_REQUIRED;stack=[];constructor(e=ExtensionCodec.defaultCodec,i=void 0,r=4294967295,n=4294967295,s=4294967295,o=4294967295,l=4294967295,a=sharedCachedKeyDecoder){this.extensionCodec=e,this.context=i,this.maxStrLength=r,this.maxBinLength=n,this.maxArrayLength=s,this.maxMapLength=o,this.maxExtLength=l,this.keyDecoder=a}reinitializeState(){this.totalPos=0,this.headByte=HEAD_BYTE_REQUIRED}setBuffer(e){this.bytes=ensureUint8Array(e),this.view=createDataView(this.bytes),this.pos=0}appendBuffer(e){if(e=ensureUint8Array(e).slice(),this.headByte===HEAD_BYTE_REQUIRED&&!this.hasRemaining())this.setBuffer(e);else{const i=this.bytes.subarray(this.pos),r=ensureUint8Array(e),n=new Uint8Array(i.length+r.length);n.set(i),n.set(r,i.length),this.setBuffer(n)}}hasRemaining(e=1){return this.view.byteLength-this.pos>=e}createNoExtraBytesError(e){const{view:i,pos:r}=this;return new RangeError(`Extra ${i.byteLength-r} of ${i.byteLength} byte(s) found at buffer[${e}]`)}decode(e){return this.reinitializeState(),this.setBuffer(e),this.doDecodeSingleSync()}doDecodeSingleSync(){const e=this.doDecodeSync();if(this.hasRemaining())throw this.createNoExtraBytesError(this.pos);return e}async decodeAsync(e){let i=!1,r;for await(const l of e){if(i)throw this.createNoExtraBytesError(this.totalPos);this.appendBuffer(l);try{r=this.doDecodeSync(),i=!0}catch(a){if(!(a instanceof DataViewIndexOutOfBoundsError))throw a}this.totalPos+=this.pos}if(i){if(this.hasRemaining())throw this.createNoExtraBytesError(this.totalPos);return r}const{headByte:n,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parcing ${prettyByte(n)} at ${o} (${s} in the current buffer)`)}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,i){let r=i,n=-1;for await(const s of e){if(i&&n===0)throw this.createNoExtraBytesError(this.totalPos);this.appendBuffer(s),r&&(n=this.readArraySize(),r=!1,this.complete());try{for(;yield this.doDecodeSync(),--n!=0;);}catch(o){if(!(o instanceof DataViewIndexOutOfBoundsError))throw o}this.totalPos+=this.pos}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let i;if(e>=224)i=e-256;else if(e<192)if(e<128)i=e;else if(e<144){const n=e-128;if(n!==0){this.pushMapState(n),this.complete();continue e}else i={}}else if(e<160){const n=e-144;if(n!==0){this.pushArrayState(n),this.complete();continue e}else i=[]}else{const n=e-160;i=this.decodeUtf8String(n,0)}else if(e===192)i=null;else if(e===194)i=!1;else if(e===195)i=!0;else if(e===202)i=this.readF32();else if(e===203)i=this.readF64();else if(e===204)i=this.readU8();else if(e===205)i=this.readU16();else if(e===206)i=this.readU32();else if(e===207)i=this.readU64();else if(e===208)i=this.readI8();else if(e===209)i=this.readI16();else if(e===210)i=this.readI32();else if(e===211)i=this.readI64();else if(e===217){const n=this.lookU8();i=this.decodeUtf8String(n,1)}else if(e===218){const n=this.lookU16();i=this.decodeUtf8String(n,2)}else if(e===219){const n=this.lookU32();i=this.decodeUtf8String(n,4)}else if(e===220){const n=this.readU16();if(n!==0){this.pushArrayState(n),this.complete();continue e}else i=[]}else if(e===221){const n=this.readU32();if(n!==0){this.pushArrayState(n),this.complete();continue e}else i=[]}else if(e===222){const n=this.readU16();if(n!==0){this.pushMapState(n),this.complete();continue e}else i={}}else if(e===223){const n=this.readU32();if(n!==0){this.pushMapState(n),this.complete();continue e}else i={}}else if(e===196){const n=this.lookU8();i=this.decodeBinary(n,1)}else if(e===197){const n=this.lookU16();i=this.decodeBinary(n,2)}else if(e===198){const n=this.lookU32();i=this.decodeBinary(n,4)}else if(e===212)i=this.decodeExtension(1,0);else if(e===213)i=this.decodeExtension(2,0);else if(e===214)i=this.decodeExtension(4,0);else if(e===215)i=this.decodeExtension(8,0);else if(e===216)i=this.decodeExtension(16,0);else if(e===199){const n=this.lookU8();i=this.decodeExtension(n,1)}else if(e===200){const n=this.lookU16();i=this.decodeExtension(n,2)}else if(e===201){const n=this.lookU32();i=this.decodeExtension(n,4)}else throw new Error(`Unrecognized type byte: ${prettyByte(e)}`);this.complete();const r=this.stack;for(;r.length>0;){const n=r[r.length-1];if(n.type===State.ARRAY)if(n.array[n.position]=i,n.position++,n.position===n.size)r.pop(),i=n.array;else continue e;else if(n.type===State.MAP_KEY){if(!isValidMapKeyType(i))throw new Error("The type of key must be string or number but "+typeof i);n.key=i,n.type=State.MAP_VALUE;continue e}else if(n.map[n.key]=i,n.readCount++,n.readCount===n.size)r.pop(),i=n.map;else{n.key=null,n.type=State.MAP_KEY;continue e}}return i}}readHeadByte(){return this.headByte===HEAD_BYTE_REQUIRED&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=HEAD_BYTE_REQUIRED}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new Error(`Unrecognized array type byte: ${prettyByte(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new Error(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.push({type:State.MAP_KEY,size:e,key:null,readCount:0,map:{}})}pushArrayState(e){if(e>this.maxArrayLength)throw new Error(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.push({type:State.ARRAY,size:e,array:new Array(e),position:0})}decodeUtf8String(e,i){if(e>this.maxStrLength)throw new Error(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+i+e)throw MORE_DATA;const r=this.pos+i;let n;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?n=this.keyDecoder.decode(this.bytes,r,e):e>200?n=utf8DecodeTD(this.bytes,r,e):n=utf8DecodeJs(this.bytes,r,e),this.pos+=i+e,n}stateIsMapKey(){return this.stack.length>0?this.stack[this.stack.length-1].type===State.MAP_KEY:!1}decodeBinary(e,i){if(e>this.maxBinLength)throw new Error(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+i))throw MORE_DATA;const r=this.pos+i,n=this.bytes.subarray(r,r+e);return this.pos+=i+e,n}decodeExtension(e,i){if(e>this.maxExtLength)throw new Error(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const r=this.view.getInt8(this.pos+i),n=this.decodeBinary(e,i+1);return this.extensionCodec.decode(n,r,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=getUint64(this.view,this.pos);return this.pos+=8,e}readI64(){const e=getInt64(this.view,this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}}const defaultDecodeOptions={};function isAsyncIterable(t){return t[Symbol.asyncIterator]!=null}function assertNonNull(t){if(t==null)throw new Error("Assertion Failure: value must not be null nor undefined")}async function*asyncIterableFromStream(t){const e=t.getReader();try{for(;;){const{done:i,value:r}=await e.read();if(i)return;assertNonNull(r),yield r}}finally{e.releaseLock()}}function ensureAsyncIterabe(t){return isAsyncIterable(t)?t:asyncIterableFromStream(t)}function decodeStream(t,e=defaultDecodeOptions){const i=ensureAsyncIterabe(t);return new Decoder(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength).decodeStream(i)}function deferred2(){let t,e="pending";const i=new Promise((r,n)=>{t={async resolve(s){await s,e="fulfilled",r(s)},reject(s){e="rejected",n(s)}}});return Object.defineProperty(i,"state",{get:()=>e}),Object.assign(i,t)}class DenoStdInternalError1 extends Error{constructor(e){super(e);this.name="DenoStdInternalError"}}function assert1(t,e=""){if(!t)throw new DenoStdInternalError1(e)}function concat(...t){let e=0;for(const n of t)e+=n.length;const i=new Uint8Array(e);let r=0;for(const n of t)i.set(n,r),r+=n.length;return i}function copy(t,e,i=0){i=Math.max(0,Math.min(i,e.byteLength));const r=e.byteLength-i;return t.byteLength>r&&(t=t.subarray(0,r)),e.set(t,i),t.byteLength}const MIN_READ=32*1024,MAX_SIZE=2**32-2;class Buffer{#e;#t=0;constructor(e){this.#e=e===void 0?new Uint8Array(0):new Uint8Array(e)}bytes(e={copy:!0}){return e.copy===!1?this.#e.subarray(this.#t):this.#e.slice(this.#t)}empty(){return this.#e.byteLength<=this.#t}get length(){return this.#e.byteLength-this.#t}get capacity(){return this.#e.buffer.byteLength}truncate(e){if(e===0){this.reset();return}if(e<0||e>this.length)throw Error("bytes.Buffer: truncation out of range");this.#i(this.#t+e)}reset(){this.#i(0),this.#t=0}#r(e){const i=this.#e.byteLength;return e<=this.capacity-i?(this.#i(i+e),i):-1}#i(e){assert1(e<=this.#e.buffer.byteLength),this.#e=new Uint8Array(this.#e.buffer,0,e)}readSync(e){if(this.empty())return this.reset(),e.byteLength===0?0:null;const i=copy(this.#e.subarray(this.#t),e);return this.#t+=i,i}read(e){const i=this.readSync(e);return Promise.resolve(i)}writeSync(e){const i=this.#n(e.byteLength);return copy(e,this.#e,i)}write(e){const i=this.writeSync(e);return Promise.resolve(i)}#n(e){const i=this.length;i===0&&this.#t!==0&&this.reset();const r=this.#r(e);if(r>=0)return r;const n=this.capacity;if(e<=Math.floor(n/2)-i)copy(this.#e.subarray(this.#t),this.#e);else{if(n+e>MAX_SIZE)throw new Error("The buffer cannot be grown beyond the maximum size.");{const s=new Uint8Array(Math.min(2*n+e,MAX_SIZE));copy(this.#e.subarray(this.#t),s),this.#e=s}}return this.#t=0,this.#i(Math.min(i+e,MAX_SIZE)),i}grow(e){if(e<0)throw Error("Buffer.grow: negative count");const i=this.#n(e);this.#i(i)}async readFrom(e){let i=0;const r=new Uint8Array(MIN_READ);for(;;){const n=this.capacity-this.length<MIN_READ,s=n?r:new Uint8Array(this.#e.buffer,this.length),o=await e.read(s);if(o===null)return i;n?this.writeSync(s.subarray(0,o)):this.#i(this.length+o),i+=o}}readFromSync(e){let i=0;const r=new Uint8Array(MIN_READ);for(;;){const n=this.capacity-this.length<MIN_READ,s=n?r:new Uint8Array(this.#e.buffer,this.length),o=e.readSync(s);if(o===null)return i;n?this.writeSync(s.subarray(0,o)):this.#i(this.length+o),i+=o}}}class BytesList{len=0;chunks=[];constructor(){}size(){return this.len}add(e,i=0,r=e.byteLength){e.byteLength===0||r-i==0||(checkRange(i,r,e.byteLength),this.chunks.push({value:e,end:r,start:i,offset:this.len}),this.len+=r-i)}shift(e){if(e===0)return;if(this.len<=e){this.chunks=[],this.len=0;return}const i=this.getChunkIndex(e);this.chunks.splice(0,i);const[r]=this.chunks;if(r){const s=e-r.offset;r.start+=s}let n=0;for(const s of this.chunks)s.offset=n,n+=s.end-s.start;this.len=n}getChunkIndex(e){let i=this.chunks.length,r=0;for(;;){const n=r+Math.floor((i-r)/2);if(n<0||this.chunks.length<=n)return-1;const{offset:s,start:o,end:l}=this.chunks[n],a=l-o;if(s<=e&&e<s+a)return n;s+a<=e?r=n+1:i=n-1}}get(e){if(e<0||this.len<=e)throw new Error("out of range");const i=this.getChunkIndex(e),{value:r,offset:n,start:s}=this.chunks[i];return r[s+e-n]}*iterator(e=0){const i=this.getChunkIndex(e);if(i<0)return;const r=this.chunks[i];let n=e-r.offset;for(let s=i;s<this.chunks.length;s++){const o=this.chunks[s];for(let l=o.start+n;l<o.end;l++)yield o.value[l];n=0}}slice(e,i=this.len){if(i===e)return new Uint8Array;checkRange(e,i,this.len);const r=new Uint8Array(i-e),n=this.getChunkIndex(e),s=this.getChunkIndex(i-1);let o=0;for(let f=n;f<s;f++){const c=this.chunks[f],h=c.end-c.start;r.set(c.value.subarray(c.start,c.end),o),o+=h}const l=this.chunks[s],a=i-e-o;return r.set(l.value.subarray(l.start,l.start+a),o),r}concat(){const e=new Uint8Array(this.len);let i=0;for(const{value:r,start:n,end:s}of this.chunks)e.set(r.subarray(n,s),i),i+=s-n;return e}}function checkRange(t,e,i){if(t<0||i<t||e<0||i<e||e<t)throw new Error("invalid range")}const{Deno:Deno1}=globalThis;typeof Deno1?.noColor=="boolean"&&Deno1.noColor,new RegExp(["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|"),"g");var DiffType;(function(t){t.removed="removed",t.common="common",t.added="added"})(DiffType||(DiffType={}));class AssertionError extends Error{name="AssertionError";constructor(e){super(e)}}function assert2(t,e=""){if(!t)throw new AssertionError(e)}const DEFAULT_BUFFER_SIZE=32*1024;async function readAll(t){const e=new Buffer;return await e.readFrom(t),e.bytes()}function readAllSync(t){const e=new Buffer;return e.readFromSync(t),e.bytes()}async function readRange(t,e){let i=e.end-e.start+1;assert2(i>0,"Invalid byte range was passed."),await t.seek(e.start,Deno.SeekMode.Start);const r=new Uint8Array(i);let n=0;for(;i;){const s=new Uint8Array(Math.min(i,DEFAULT_BUFFER_SIZE)),o=await t.read(s);assert2(o!==null,"Unexpected EOF reach while reading a range."),assert2(o>0,"Unexpected read of 0 bytes while reading a range."),copy(s,r,n),n+=o,i-=o,assert2(i>=0,"Unexpected length remaining after reading range.")}return r}function readRangeSync(t,e){let i=e.end-e.start+1;assert2(i>0,"Invalid byte range was passed."),t.seekSync(e.start,Deno.SeekMode.Start);const r=new Uint8Array(i);let n=0;for(;i;){const s=new Uint8Array(Math.min(i,DEFAULT_BUFFER_SIZE)),o=t.readSync(s);assert2(o!==null,"Unexpected EOF reach while reading a range."),assert2(o>0,"Unexpected read of 0 bytes while reading a range."),copy(s,r,n),n+=o,i-=o,assert2(i>=0,"Unexpected length remaining after reading range.")}return r}async function writeAll(t,e){let i=0;for(;i<e.length;)i+=await t.write(e.subarray(i))}function writeAllSync(t,e){let i=0;for(;i<e.length;)i+=t.writeSync(e.subarray(i))}async function*iter(t,e){const i=e?.bufSize??DEFAULT_BUFFER_SIZE,r=new Uint8Array(i);for(;;){const n=await t.read(r);if(n===null)break;yield r.subarray(0,n)}}function*iterSync(t,e){const i=e?.bufSize??DEFAULT_BUFFER_SIZE,r=new Uint8Array(i);for(;;){const n=t.readSync(r);if(n===null)break;yield r.subarray(0,n)}}async function copy1(t,e,i){let r=0;const n=i?.bufSize??DEFAULT_BUFFER_SIZE,s=new Uint8Array(n);let o=!1;for(;o===!1;){const l=await t.read(s);if(l===null)o=!0;else{let a=0;for(;a<l;)a+=await e.write(s.subarray(a,l));r+=a}}return r}const DEFAULT_BUF_SIZE=4096,MIN_BUF_SIZE=16,CR="\r".charCodeAt(0),LF=`
`.charCodeAt(0);class BufferFullError extends Error{partial;name="BufferFullError";constructor(e){super("Buffer full");this.partial=e}}class PartialReadError extends Error{name="PartialReadError";partial;constructor(){super("Encountered UnexpectedEof, data only partially read")}}class BufReader{buf;rd;r=0;w=0;eof=!1;static create(e,i=4096){return e instanceof BufReader?e:new BufReader(e,i)}constructor(e,i=4096){i<16&&(i=MIN_BUF_SIZE),this._reset(new Uint8Array(i),e)}size(){return this.buf.byteLength}buffered(){return this.w-this.r}async _fill(){if(this.r>0&&(this.buf.copyWithin(0,this.r,this.w),this.w-=this.r,this.r=0),this.w>=this.buf.byteLength)throw Error("bufio: tried to fill full buffer");for(let e=100;e>0;e--){const i=await this.rd.read(this.buf.subarray(this.w));if(i===null){this.eof=!0;return}if(assert1(i>=0,"negative read"),this.w+=i,i>0)return}throw new Error(`No progress after ${100} read() calls`)}reset(e){this._reset(this.buf,e)}_reset(e,i){this.buf=e,this.rd=i,this.eof=!1}async read(e){let i=e.byteLength;if(e.byteLength===0)return i;if(this.r===this.w){if(e.byteLength>=this.buf.byteLength){const n=await this.rd.read(e);return assert1((n??0)>=0,"negative read"),n}if(this.r=0,this.w=0,i=await this.rd.read(this.buf),i===0||i===null)return i;assert1(i>=0,"negative read"),this.w+=i}const r=copy(this.buf.subarray(this.r,this.w),e,0);return this.r+=r,r}async readFull(e){let i=0;for(;i<e.length;)try{const r=await this.read(e.subarray(i));if(r===null){if(i===0)return null;throw new PartialReadError}i+=r}catch(r){if(r instanceof PartialReadError)r.partial=e.subarray(0,i);else if(r instanceof Error){const n=new PartialReadError;throw n.partial=e.subarray(0,i),n.stack=r.stack,n.message=r.message,n.cause=r.cause,r}throw r}return e}async readByte(){for(;this.r===this.w;){if(this.eof)return null;await this._fill()}const e=this.buf[this.r];return this.r++,e}async readString(e){if(e.length!==1)throw new Error("Delimiter should be a single character");const i=await this.readSlice(e.charCodeAt(0));return i===null?null:new TextDecoder().decode(i)}async readLine(){let e=null;try{e=await this.readSlice(LF)}catch(i){if(i instanceof Deno.errors.BadResource)throw i;let r;if(i instanceof PartialReadError&&(r=i.partial,assert1(r instanceof Uint8Array,"bufio: caught error from `readSlice()` without `partial` property")),!(i instanceof BufferFullError))throw i;if(!this.eof&&r&&r.byteLength>0&&r[r.byteLength-1]===CR&&(assert1(this.r>0,"bufio: tried to rewind past start of buffer"),this.r--,r=r.subarray(0,r.byteLength-1)),r)return{line:r,more:!this.eof}}if(e===null)return null;if(e.byteLength===0)return{line:e,more:!1};if(e[e.byteLength-1]==LF){let i=1;e.byteLength>1&&e[e.byteLength-2]===CR&&(i=2),e=e.subarray(0,e.byteLength-i)}return{line:e,more:!1}}async readSlice(e){let i=0,r;for(;;){let n=this.buf.subarray(this.r+i,this.w).indexOf(e);if(n>=0){n+=i,r=this.buf.subarray(this.r,this.r+n+1),this.r+=n+1;break}if(this.eof){if(this.r===this.w)return null;r=this.buf.subarray(this.r,this.w),this.r=this.w;break}if(this.buffered()>=this.buf.byteLength){this.r=this.w;const s=this.buf,o=this.buf.slice(0);throw this.buf=o,new BufferFullError(s)}i=this.w-this.r;try{await this._fill()}catch(s){if(s instanceof PartialReadError)s.partial=r;else if(s instanceof Error){const o=new PartialReadError;throw o.partial=r,o.stack=s.stack,o.message=s.message,o.cause=s.cause,s}throw s}}return r}async peek(e){if(e<0)throw Error("negative count");let i=this.w-this.r;for(;i<e&&i<this.buf.byteLength&&!this.eof;){try{await this._fill()}catch(r){if(r instanceof PartialReadError)r.partial=this.buf.subarray(this.r,this.w);else if(r instanceof Error){const n=new PartialReadError;throw n.partial=this.buf.subarray(this.r,this.w),n.stack=r.stack,n.message=r.message,n.cause=r.cause,r}throw r}i=this.w-this.r}if(i===0&&this.eof)return null;if(i<e&&this.eof)return this.buf.subarray(this.r,this.r+i);if(i<e)throw new BufferFullError(this.buf.subarray(this.r,this.w));return this.buf.subarray(this.r,this.r+e)}}class AbstractBufBase{buf;usedBufferBytes=0;err=null;size(){return this.buf.byteLength}available(){return this.buf.byteLength-this.usedBufferBytes}buffered(){return this.usedBufferBytes}}class BufWriter extends AbstractBufBase{writer;static create(e,i=4096){return e instanceof BufWriter?e:new BufWriter(e,i)}constructor(e,i=4096){super();this.writer=e,i<=0&&(i=DEFAULT_BUF_SIZE),this.buf=new Uint8Array(i)}reset(e){this.err=null,this.usedBufferBytes=0,this.writer=e}async flush(){if(this.err!==null)throw this.err;if(this.usedBufferBytes!==0){try{await writeAll(this.writer,this.buf.subarray(0,this.usedBufferBytes))}catch(e){throw e instanceof Error&&(this.err=e),e}this.buf=new Uint8Array(this.buf.length),this.usedBufferBytes=0}}async write(e){if(this.err!==null)throw this.err;if(e.length===0)return 0;let i=0,r=0;for(;e.byteLength>this.available();){if(this.buffered()===0)try{r=await this.writer.write(e)}catch(n){throw n instanceof Error&&(this.err=n),n}else r=copy(e,this.buf,this.usedBufferBytes),this.usedBufferBytes+=r,await this.flush();i+=r,e=e.subarray(r)}return r=copy(e,this.buf,this.usedBufferBytes),this.usedBufferBytes+=r,i+=r,i}}class BufWriterSync extends AbstractBufBase{writer;static create(e,i=4096){return e instanceof BufWriterSync?e:new BufWriterSync(e,i)}constructor(e,i=4096){super();this.writer=e,i<=0&&(i=DEFAULT_BUF_SIZE),this.buf=new Uint8Array(i)}reset(e){this.err=null,this.usedBufferBytes=0,this.writer=e}flush(){if(this.err!==null)throw this.err;if(this.usedBufferBytes!==0){try{writeAllSync(this.writer,this.buf.subarray(0,this.usedBufferBytes))}catch(e){throw e instanceof Error&&(this.err=e),e}this.buf=new Uint8Array(this.buf.length),this.usedBufferBytes=0}}writeSync(e){if(this.err!==null)throw this.err;if(e.length===0)return 0;let i=0,r=0;for(;e.byteLength>this.available();){if(this.buffered()===0)try{r=this.writer.writeSync(e)}catch(n){throw n instanceof Error&&(this.err=n),n}else r=copy(e,this.buf,this.usedBufferBytes),this.usedBufferBytes+=r,this.flush();i+=r,e=e.subarray(r)}return r=copy(e,this.buf,this.usedBufferBytes),this.usedBufferBytes+=r,i+=r,i}}function createLPS(t){const e=new Uint8Array(t.length);e[0]=0;let i=0,r=1;for(;r<e.length;)t[r]==t[i]?(i++,e[r]=i,r++):i===0?(e[r]=0,r++):i=e[i-1];return e}async function*readDelim(t,e){const i=e.length,r=createLPS(e),n=new BytesList,s=Math.max(1024,i+1);let o=0,l=0;for(;;){const a=new Uint8Array(s),f=await t.read(a);if(f===null){yield n.concat();return}else if(f<0)return;n.add(a,0,f);let c=0;for(;o<n.size();)if(a[c]===e[l]){if(o++,c++,l++,l===i){const h=o-i;yield n.slice(0,h),n.shift(o),o=0,l=0}}else l===0?(o++,c++):l=r[l-1]}}async function*readStringDelim(t,e,i){const r=new TextEncoder,n=new TextDecoder(i?.encoding,i);for await(const s of readDelim(t,r.encode(e)))yield n.decode(s)}async function*readLines(t,e){const i=new BufReader(t);let r=[];const n=new TextDecoder(e?.encoding,e);for(;;){const s=await i.readLine();if(!s){r.length>0&&(yield n.decode(concat(...r)));break}r.push(s.line),s.more||(yield n.decode(concat(...r)),r=[])}}const DEFAULT_BUFFER_SIZE1=32*1024;async function copyN(t,e,i){let r=0,n=new Uint8Array(DEFAULT_BUFFER_SIZE1);for(;r<i;){i-r<DEFAULT_BUFFER_SIZE1&&(n=new Uint8Array(i-r));const s=await t.read(n),o=s??0;if(r+=o,o>0){let l=0;for(;l<o;)l+=await e.write(n.slice(l,o));assert1(l===o,"could not write")}if(s===null)break}return r}async function readShort(t){const e=await t.readByte();if(e===null)return null;const i=await t.readByte();if(i===null)throw new Deno.errors.UnexpectedEof;return e<<8|i}async function readInt(t){const e=await readShort(t);if(e===null)return null;const i=await readShort(t);if(i===null)throw new Deno.errors.UnexpectedEof;return e<<16|i}const MAX_SAFE_INTEGER=BigInt(Number.MAX_SAFE_INTEGER);async function readLong(t){const e=await readInt(t);if(e===null)return null;const i=await readInt(t);if(i===null)throw new Deno.errors.UnexpectedEof;const r=BigInt(e)<<32n|BigInt(i);if(r>MAX_SAFE_INTEGER)throw new RangeError("Long value too big to be represented as a JavaScript number.");return Number(r)}function sliceLongToBytes(t,e=new Array(8)){let i=BigInt(t);for(let r=0;r<8;r++)e[7-r]=Number(i&255n),i>>=8n;return e}class StringReader extends Buffer{constructor(e){super(new TextEncoder().encode(e).buffer)}}class MultiReader{readers;currentIndex=0;constructor(...e){this.readers=e}async read(e){const i=this.readers[this.currentIndex];if(!i)return null;const r=await i.read(e);return r===null?(this.currentIndex++,0):r}}class LimitedReader{reader;limit;constructor(e,i){this.reader=e,this.limit=i}async read(e){if(this.limit<=0)return null;e.length>this.limit&&(e=e.subarray(0,this.limit));const i=await this.reader.read(e);return i==null?null:(this.limit-=i,i)}}function isCloser(t){return typeof t=="object"&&t!=null&&"close"in t&&typeof t.close=="function"}function readerFromIterable(t){const e=t[Symbol.asyncIterator]?.()??t[Symbol.iterator]?.(),i=new Buffer;return{async read(r){if(i.length==0){const n=await e.next();return n.done?null:n.value.byteLength<=r.byteLength?(r.set(n.value),n.value.byteLength):(r.set(n.value.subarray(0,r.byteLength)),await writeAll(i,n.value.subarray(r.byteLength)),r.byteLength)}else{const n=await i.read(r);return n??this.read(r)}}}}function writerFromStreamWriter(t){return{async write(e){return await t.ready,await t.write(e),e.length}}}function readerFromStreamReader(t){const e=new Buffer;return{async read(i){if(e.empty()){const r=await t.read();if(r.done)return null;await writeAll(e,r.value)}return e.read(i)}}}function writableStreamFromWriter(t,e={}){const{autoClose:i=!0}=e;return new WritableStream({async write(r,n){try{await writeAll(t,r)}catch(s){n.error(s),isCloser(t)&&i&&t.close()}},close(){isCloser(t)&&i&&t.close()},abort(){isCloser(t)&&i&&t.close()}})}function readableStreamFromIterable(t){const e=t[Symbol.asyncIterator]?.()??t[Symbol.iterator]?.();return new ReadableStream({async pull(i){const{value:r,done:n}=await e.next();n?i.close():i.enqueue(r)},async cancel(i){if(typeof e.throw=="function")try{await e.throw(i)}catch{}}})}function readableStreamFromReader(t,e={}){const{autoClose:i=!0,chunkSize:r=16640,strategy:n}=e;return new ReadableStream({async pull(s){const o=new Uint8Array(r);try{const l=await t.read(o);if(l===null){isCloser(t)&&i&&t.close(),s.close();return}s.enqueue(o.subarray(0,l))}catch(l){s.error(l),isCloser(t)&&t.close()}},cancel(){isCloser(t)&&i&&t.close()}},n)}const decoder=new TextDecoder;class StringWriter{base;chunks=[];byteLength=0;cache;constructor(e=""){this.base=e;const i=new TextEncoder().encode(e);this.chunks.push(i),this.byteLength+=i.byteLength}write(e){return Promise.resolve(this.writeSync(e))}writeSync(e){return this.chunks.push(e),this.byteLength+=e.byteLength,this.cache=void 0,e.byteLength}toString(){if(this.cache)return this.cache;const e=new Uint8Array(this.byteLength);let i=0;for(const r of this.chunks)e.set(r,i),i+=r.byteLength;return this.cache=decoder.decode(e),this.cache}}const mod3={Buffer,BufferFullError,PartialReadError,BufReader,BufWriter,BufWriterSync,readDelim,readStringDelim,readLines,readAll,readAllSync,readRange,readRangeSync,writeAll,writeAllSync,iter,iterSync,copy:copy1,copyN,readShort,readInt,readLong,sliceLongToBytes,StringReader,MultiReader,LimitedReader,readerFromIterable,writerFromStreamWriter,readerFromStreamReader,writableStreamFromWriter,readableStreamFromIterable,readableStreamFromReader,StringWriter};function isRequestMessage(t){return Array.isArray(t)&&t.length===4&&t[0]===0&&typeof t[1]=="number"&&typeof t[2]=="string"&&Array.isArray(t[3])}function isResponseMessage(t){return Array.isArray(t)&&t.length===4&&t[0]===1&&typeof t[1]=="number"&&typeof t[2]!="undefined"&&typeof t[3]!="undefined"}function isNotificationMessage(t){return Array.isArray(t)&&t.length===3&&t[0]===2&&typeof t[1]=="string"&&Array.isArray(t[2])}class Indexer{#e;#t;constructor(e){if(e!=null&&e<2)throw new Error(`The attribute 'max' must be greater than 1 but ${e} has specified`);this.#e=e??Number.MAX_SAFE_INTEGER,this.#t=-1}next(){return this.#t>=this.#e&&(this.#t=-1),this.#t+=1,this.#t}}class TimeoutError extends Error{constructor(){super("the process didn't complete in time");this.name="TimeoutError"}}class ResponseWaiter{#e;#t;constructor(e=1e4){this.#e=new Map,this.#t=e}get waiterCount(){return this.#e.size}wait(e,i){let r=this.#e.get(e)?.response;if(!r){r=deferred2();const n=setTimeout(()=>{const s=this.#e.get(e)?.response;!s||(s.reject(new TimeoutError),this.#e.delete(e))},i??this.#t);this.#e.set(e,{timer:n,response:r})}return r}provide(e){const[i,r,n,s]=e,o=this.#e.get(r);if(!o)return!1;this.#e.delete(r);const{timer:l,response:a}=o;return clearTimeout(l),a.resolve(e),!0}}const MSGID_THRESHOLD=2**32;class Session{#e;#t;#r;#i;#n;#s;#o;dispatcher;constructor(e,i,r={},n={}){this.dispatcher=r,this.#e=new Indexer(MSGID_THRESHOLD),this.#t=new ResponseWaiter(n.responseTimeout),this.#r=e,this.#i=i,this.#s=!1,this.#o=deferred2(),this.#n=this.listen().catch(s=>{n.errorCallback?n.errorCallback(s):console.error(`Unexpected error occured in session: ${s}`)})}async send(e){await mod3.writeAll(this.#i,e)}async dispatch(e,...i){if(!Object.prototype.hasOwnProperty.call(this.dispatcher,e)){const r=Object.getOwnPropertyNames(this.dispatcher);throw new Error(`No method '${e}' exists in ${JSON.stringify(r)}`)}return await this.dispatcher[e].apply(this,i)}async handleRequest(e){const[i,r,n,s]=e,[o,l]=await(async()=>{let f=null,c=null;try{f=await this.dispatch(n,...s)}catch(h){c=h.stack??h.toString()}return[f,c]})(),a=[1,r,l,o];await this.send(encode1(a))}handleResponse(e){this.#t.provide(e)||console.warn("Unexpected response message received",e)}async handleNotification(e){const[i,r,n]=e;try{await this.dispatch(r,...n)}catch(s){console.error(s)}}async listen(){const e=decodeStream(mod3.iter(this.#r));try{for(;!this.#s;){const{done:i,value:r}=await Promise.race([this.#o,e.next()]);if(i)return;if(isRequestMessage(r))this.handleRequest(r);else if(isResponseMessage(r))this.handleResponse(r);else if(isNotificationMessage(r))this.handleNotification(r);else{console.warn(`Unexpected data received: ${r}`);continue}}}catch(i){if(i instanceof SessionClosedError||i instanceof Deno.errors.BadResource)return;throw i}}dispose(){this.close()}close(){this.#s=!0,this.#o.reject(new SessionClosedError)}waitClosed(){return this.#n}async call(e,...i){if(this.#s)throw new SessionClosedError;const r=this.#e.next(),n=[0,r,e,i],[s,o]=await Promise.race([this.#o,Promise.all([this.send(encode1(n)),this.#t.wait(r)])]),[l,a]=o.slice(2);if(l){const f=JSON.stringify(i),c=typeof l=="string"?l:JSON.stringify(l);throw new Error(`Failed to call '${e}' with ${f}: ${c}`)}return a}async notify(e,...i){if(this.#s)throw new SessionClosedError;const r=[2,e,i];await Promise.race([this.#o,this.send(encode1(r))])}clearDispatcher(){this.dispatcher={}}extendDispatcher(e){this.dispatcher={...this.dispatcher,...e}}}class SessionClosedError extends Error{constructor(){super("The session is closed");this.name="SessionClosedError"}}class DenoStdInternalError2 extends Error{constructor(e){super(e);this.name="DenoStdInternalError"}}function assert3(t,e=""){if(!t)throw new DenoStdInternalError2(e)}function copy2(t,e,i=0){i=Math.max(0,Math.min(i,e.byteLength));const r=e.byteLength-i;return t.byteLength>r&&(t=t.subarray(0,r)),e.set(t,i),t.byteLength}const{Deno:Deno2}=globalThis;typeof Deno2?.noColor=="boolean"&&Deno2.noColor,new RegExp(["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|"),"g");var DiffType1;(function(t){t.removed="removed",t.common="common",t.added="added"})(DiffType1||(DiffType1={}));async function writeAll1(t,e){let i=0;for(;i<e.length;)i+=await t.write(e.subarray(i))}function writeAllSync1(t,e){let i=0;for(;i<e.length;)i+=t.writeSync(e.subarray(i))}const DEFAULT_BUF_SIZE1=4096,MIN_BUF_SIZE1=16,CR1="\r".charCodeAt(0),LF1=`
`.charCodeAt(0);class BufferFullError1 extends Error{partial;name="BufferFullError";constructor(e){super("Buffer full");this.partial=e}}class PartialReadError1 extends Error{name="PartialReadError";partial;constructor(){super("Encountered UnexpectedEof, data only partially read")}}class BufReader1{buf;rd;r=0;w=0;eof=!1;static create(e,i=4096){return e instanceof BufReader1?e:new BufReader1(e,i)}constructor(e,i=4096){i<16&&(i=MIN_BUF_SIZE1),this._reset(new Uint8Array(i),e)}size(){return this.buf.byteLength}buffered(){return this.w-this.r}async _fill(){if(this.r>0&&(this.buf.copyWithin(0,this.r,this.w),this.w-=this.r,this.r=0),this.w>=this.buf.byteLength)throw Error("bufio: tried to fill full buffer");for(let e=100;e>0;e--){const i=await this.rd.read(this.buf.subarray(this.w));if(i===null){this.eof=!0;return}if(assert3(i>=0,"negative read"),this.w+=i,i>0)return}throw new Error(`No progress after ${100} read() calls`)}reset(e){this._reset(this.buf,e)}_reset(e,i){this.buf=e,this.rd=i,this.eof=!1}async read(e){let i=e.byteLength;if(e.byteLength===0)return i;if(this.r===this.w){if(e.byteLength>=this.buf.byteLength){const n=await this.rd.read(e);return assert3((n??0)>=0,"negative read"),n}if(this.r=0,this.w=0,i=await this.rd.read(this.buf),i===0||i===null)return i;assert3(i>=0,"negative read"),this.w+=i}const r=copy2(this.buf.subarray(this.r,this.w),e,0);return this.r+=r,r}async readFull(e){let i=0;for(;i<e.length;)try{const r=await this.read(e.subarray(i));if(r===null){if(i===0)return null;throw new PartialReadError1}i+=r}catch(r){throw r.partial=e.subarray(0,i),r}return e}async readByte(){for(;this.r===this.w;){if(this.eof)return null;await this._fill()}const e=this.buf[this.r];return this.r++,e}async readString(e){if(e.length!==1)throw new Error("Delimiter should be a single character");const i=await this.readSlice(e.charCodeAt(0));return i===null?null:new TextDecoder().decode(i)}async readLine(){let e;try{e=await this.readSlice(LF1)}catch(i){if(i instanceof Deno.errors.BadResource)throw i;let{partial:r}=i;if(assert3(r instanceof Uint8Array,"bufio: caught error from `readSlice()` without `partial` property"),!(i instanceof BufferFullError1))throw i;return!this.eof&&r.byteLength>0&&r[r.byteLength-1]===CR1&&(assert3(this.r>0,"bufio: tried to rewind past start of buffer"),this.r--,r=r.subarray(0,r.byteLength-1)),{line:r,more:!this.eof}}if(e===null)return null;if(e.byteLength===0)return{line:e,more:!1};if(e[e.byteLength-1]==LF1){let i=1;e.byteLength>1&&e[e.byteLength-2]===CR1&&(i=2),e=e.subarray(0,e.byteLength-i)}return{line:e,more:!1}}async readSlice(e){let i=0,r;for(;;){let n=this.buf.subarray(this.r+i,this.w).indexOf(e);if(n>=0){n+=i,r=this.buf.subarray(this.r,this.r+n+1),this.r+=n+1;break}if(this.eof){if(this.r===this.w)return null;r=this.buf.subarray(this.r,this.w),this.r=this.w;break}if(this.buffered()>=this.buf.byteLength){this.r=this.w;const s=this.buf,o=this.buf.slice(0);throw this.buf=o,new BufferFullError1(s)}i=this.w-this.r;try{await this._fill()}catch(s){throw s.partial=r,s}}return r}async peek(e){if(e<0)throw Error("negative count");let i=this.w-this.r;for(;i<e&&i<this.buf.byteLength&&!this.eof;){try{await this._fill()}catch(r){throw r.partial=this.buf.subarray(this.r,this.w),r}i=this.w-this.r}if(i===0&&this.eof)return null;if(i<e&&this.eof)return this.buf.subarray(this.r,this.r+i);if(i<e)throw new BufferFullError1(this.buf.subarray(this.r,this.w));return this.buf.subarray(this.r,this.r+e)}}class AbstractBufBase1{buf;usedBufferBytes=0;err=null;size(){return this.buf.byteLength}available(){return this.buf.byteLength-this.usedBufferBytes}buffered(){return this.usedBufferBytes}}class BufWriter1 extends AbstractBufBase1{writer;static create(e,i=4096){return e instanceof BufWriter1?e:new BufWriter1(e,i)}constructor(e,i=4096){super();this.writer=e,i<=0&&(i=DEFAULT_BUF_SIZE1),this.buf=new Uint8Array(i)}reset(e){this.err=null,this.usedBufferBytes=0,this.writer=e}async flush(){if(this.err!==null)throw this.err;if(this.usedBufferBytes!==0){try{await writeAll1(this.writer,this.buf.subarray(0,this.usedBufferBytes))}catch(e){throw this.err=e,e}this.buf=new Uint8Array(this.buf.length),this.usedBufferBytes=0}}async write(e){if(this.err!==null)throw this.err;if(e.length===0)return 0;let i=0,r=0;for(;e.byteLength>this.available();){if(this.buffered()===0)try{r=await this.writer.write(e)}catch(n){throw this.err=n,n}else r=copy2(e,this.buf,this.usedBufferBytes),this.usedBufferBytes+=r,await this.flush();i+=r,e=e.subarray(r)}return r=copy2(e,this.buf,this.usedBufferBytes),this.usedBufferBytes+=r,i+=r,i}}class BufWriterSync1 extends AbstractBufBase1{writer;static create(e,i=4096){return e instanceof BufWriterSync1?e:new BufWriterSync1(e,i)}constructor(e,i=4096){super();this.writer=e,i<=0&&(i=DEFAULT_BUF_SIZE1),this.buf=new Uint8Array(i)}reset(e){this.err=null,this.usedBufferBytes=0,this.writer=e}flush(){if(this.err!==null)throw this.err;if(this.usedBufferBytes!==0){try{writeAllSync1(this.writer,this.buf.subarray(0,this.usedBufferBytes))}catch(e){throw this.err=e,e}this.buf=new Uint8Array(this.buf.length),this.usedBufferBytes=0}}writeSync(e){if(this.err!==null)throw this.err;if(e.length===0)return 0;let i=0,r=0;for(;e.byteLength>this.available();){if(this.buffered()===0)try{r=this.writer.writeSync(e)}catch(n){throw this.err=n,n}else r=copy2(e,this.buf,this.usedBufferBytes),this.usedBufferBytes+=r,this.flush();i+=r,e=e.subarray(r)}return r=copy2(e,this.buf,this.usedBufferBytes),this.usedBufferBytes+=r,i+=r,i}}BigInt(Number.MAX_SAFE_INTEGER),new TextDecoder;var charset;(function(t){t[t.BACKSPACE=8]="BACKSPACE",t[t.FORM_FEED=12]="FORM_FEED",t[t.NEWLINE=10]="NEWLINE",t[t.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",t[t.TAB=9]="TAB",t[t.SPACE=32]="SPACE",t[t.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",t[t.QUOTATION_MARK=34]="QUOTATION_MARK",t[t.NUMBER_SIGN=35]="NUMBER_SIGN",t[t.DOLLAR_SIGN=36]="DOLLAR_SIGN",t[t.PERCENT_SIGN=37]="PERCENT_SIGN",t[t.AMPERSAND=38]="AMPERSAND",t[t.APOSTROPHE=39]="APOSTROPHE",t[t.LEFT_PARENTHESIS=40]="LEFT_PARENTHESIS",t[t.RIGHT_PARENTHESIS=41]="RIGHT_PARENTHESIS",t[t.ASTERISK=42]="ASTERISK",t[t.PLUS_SIGN=43]="PLUS_SIGN",t[t.COMMA=44]="COMMA",t[t.HYPHEN_MINUS=45]="HYPHEN_MINUS",t[t.FULL_STOP=46]="FULL_STOP",t[t.SOLIDUS=47]="SOLIDUS",t[t.DIGIT_ZERO=48]="DIGIT_ZERO",t[t.DIGIT_ONE=49]="DIGIT_ONE",t[t.DIGIT_TWO=50]="DIGIT_TWO",t[t.DIGIT_THREE=51]="DIGIT_THREE",t[t.DIGIT_FOUR=52]="DIGIT_FOUR",t[t.DIGIT_FIVE=53]="DIGIT_FIVE",t[t.DIGIT_SIX=54]="DIGIT_SIX",t[t.DIGIT_SEVEN=55]="DIGIT_SEVEN",t[t.DIGIT_EIGHT=56]="DIGIT_EIGHT",t[t.DIGIT_NINE=57]="DIGIT_NINE",t[t.COLON=58]="COLON",t[t.SEMICOLON=59]="SEMICOLON",t[t.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",t[t.EQUALS_SIGN=61]="EQUALS_SIGN",t[t.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",t[t.QUESTION_MARK=63]="QUESTION_MARK",t[t.COMMERCIAL_AT=64]="COMMERCIAL_AT",t[t.LATIN_CAPITAL_LETTER_A=65]="LATIN_CAPITAL_LETTER_A",t[t.LATIN_CAPITAL_LETTER_B=66]="LATIN_CAPITAL_LETTER_B",t[t.LATIN_CAPITAL_LETTER_C=67]="LATIN_CAPITAL_LETTER_C",t[t.LATIN_CAPITAL_LETTER_D=68]="LATIN_CAPITAL_LETTER_D",t[t.LATIN_CAPITAL_LETTER_E=69]="LATIN_CAPITAL_LETTER_E",t[t.LATIN_CAPITAL_LETTER_F=70]="LATIN_CAPITAL_LETTER_F",t[t.LATIN_CAPITAL_LETTER_G=71]="LATIN_CAPITAL_LETTER_G",t[t.LATIN_CAPITAL_LETTER_H=72]="LATIN_CAPITAL_LETTER_H",t[t.LATIN_CAPITAL_LETTER_I=73]="LATIN_CAPITAL_LETTER_I",t[t.LATIN_CAPITAL_LETTER_J=74]="LATIN_CAPITAL_LETTER_J",t[t.LATIN_CAPITAL_LETTER_K=75]="LATIN_CAPITAL_LETTER_K",t[t.LATIN_CAPITAL_LETTER_L=76]="LATIN_CAPITAL_LETTER_L",t[t.LATIN_CAPITAL_LETTER_M=77]="LATIN_CAPITAL_LETTER_M",t[t.LATIN_CAPITAL_LETTER_N=78]="LATIN_CAPITAL_LETTER_N",t[t.LATIN_CAPITAL_LETTER_O=79]="LATIN_CAPITAL_LETTER_O",t[t.LATIN_CAPITAL_LETTER_P=80]="LATIN_CAPITAL_LETTER_P",t[t.LATIN_CAPITAL_LETTER_Q=81]="LATIN_CAPITAL_LETTER_Q",t[t.LATIN_CAPITAL_LETTER_R=82]="LATIN_CAPITAL_LETTER_R",t[t.LATIN_CAPITAL_LETTER_S=83]="LATIN_CAPITAL_LETTER_S",t[t.LATIN_CAPITAL_LETTER_T=84]="LATIN_CAPITAL_LETTER_T",t[t.LATIN_CAPITAL_LETTER_U=85]="LATIN_CAPITAL_LETTER_U",t[t.LATIN_CAPITAL_LETTER_V=86]="LATIN_CAPITAL_LETTER_V",t[t.LATIN_CAPITAL_LETTER_W=87]="LATIN_CAPITAL_LETTER_W",t[t.LATIN_CAPITAL_LETTER_X=88]="LATIN_CAPITAL_LETTER_X",t[t.LATIN_CAPITAL_LETTER_Y=89]="LATIN_CAPITAL_LETTER_Y",t[t.LATIN_CAPITAL_LETTER_Z=90]="LATIN_CAPITAL_LETTER_Z",t[t.LEFT_SQUARE_BRACKET=91]="LEFT_SQUARE_BRACKET",t[t.REVERSE_SOLIDUS=92]="REVERSE_SOLIDUS",t[t.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",t[t.CIRCUMFLEX_ACCENT=94]="CIRCUMFLEX_ACCENT",t[t.LOW_LINE=95]="LOW_LINE",t[t.GRAVE_ACCENT=96]="GRAVE_ACCENT",t[t.LATIN_SMALL_LETTER_A=97]="LATIN_SMALL_LETTER_A",t[t.LATIN_SMALL_LETTER_B=98]="LATIN_SMALL_LETTER_B",t[t.LATIN_SMALL_LETTER_C=99]="LATIN_SMALL_LETTER_C",t[t.LATIN_SMALL_LETTER_D=100]="LATIN_SMALL_LETTER_D",t[t.LATIN_SMALL_LETTER_E=101]="LATIN_SMALL_LETTER_E",t[t.LATIN_SMALL_LETTER_F=102]="LATIN_SMALL_LETTER_F",t[t.LATIN_SMALL_LETTER_G=103]="LATIN_SMALL_LETTER_G",t[t.LATIN_SMALL_LETTER_H=104]="LATIN_SMALL_LETTER_H",t[t.LATIN_SMALL_LETTER_I=105]="LATIN_SMALL_LETTER_I",t[t.LATIN_SMALL_LETTER_J=106]="LATIN_SMALL_LETTER_J",t[t.LATIN_SMALL_LETTER_K=107]="LATIN_SMALL_LETTER_K",t[t.LATIN_SMALL_LETTER_L=108]="LATIN_SMALL_LETTER_L",t[t.LATIN_SMALL_LETTER_M=109]="LATIN_SMALL_LETTER_M",t[t.LATIN_SMALL_LETTER_N=110]="LATIN_SMALL_LETTER_N",t[t.LATIN_SMALL_LETTER_O=111]="LATIN_SMALL_LETTER_O",t[t.LATIN_SMALL_LETTER_P=112]="LATIN_SMALL_LETTER_P",t[t.LATIN_SMALL_LETTER_Q=113]="LATIN_SMALL_LETTER_Q",t[t.LATIN_SMALL_LETTER_R=114]="LATIN_SMALL_LETTER_R",t[t.LATIN_SMALL_LETTER_S=115]="LATIN_SMALL_LETTER_S",t[t.LATIN_SMALL_LETTER_T=116]="LATIN_SMALL_LETTER_T",t[t.LATIN_SMALL_LETTER_U=117]="LATIN_SMALL_LETTER_U",t[t.LATIN_SMALL_LETTER_V=118]="LATIN_SMALL_LETTER_V",t[t.LATIN_SMALL_LETTER_W=119]="LATIN_SMALL_LETTER_W",t[t.LATIN_SMALL_LETTER_X=120]="LATIN_SMALL_LETTER_X",t[t.LATIN_SMALL_LETTER_Y=121]="LATIN_SMALL_LETTER_Y",t[t.LATIN_SMALL_LETTER_Z=122]="LATIN_SMALL_LETTER_Z",t[t.LEFT_CURLY_BRACKET=123]="LEFT_CURLY_BRACKET",t[t.VERTICAL_LINE=124]="VERTICAL_LINE",t[t.RIGHT_CURLY_BRACKET=125]="RIGHT_CURLY_BRACKET",t[t.TILDE=126]="TILDE"})(charset||(charset={})),charset.QUOTATION_MARK+"",charset.QUOTATION_MARK,charset.REVERSE_SOLIDUS+"",charset.REVERSE_SOLIDUS,charset.SOLIDUS+"",charset.SOLIDUS,charset.LATIN_SMALL_LETTER_B+"",charset.BACKSPACE,charset.LATIN_SMALL_LETTER_F+"",charset.FORM_FEED,charset.LATIN_SMALL_LETTER_N+"",charset.NEWLINE,charset.LATIN_SMALL_LETTER_R+"",charset.CARRIAGE_RETURN,charset.LATIN_SMALL_LETTER_T+"",charset.TAB;var TokenType;(function(t){t[t.LEFT_BRACE=1]="LEFT_BRACE",t[t.RIGHT_BRACE=2]="RIGHT_BRACE",t[t.LEFT_BRACKET=3]="LEFT_BRACKET",t[t.RIGHT_BRACKET=4]="RIGHT_BRACKET",t[t.COLON=5]="COLON",t[t.COMMA=6]="COMMA",t[t.TRUE=7]="TRUE",t[t.FALSE=8]="FALSE",t[t.NULL=9]="NULL",t[t.STRING=10]="STRING",t[t.NUMBER=11]="NUMBER"})(TokenType||(TokenType={}));const{LEFT_BRACE,RIGHT_BRACE,LEFT_BRACKET,RIGHT_BRACKET,COLON,COMMA,TRUE,FALSE,NULL,STRING,NUMBER}=TokenType;var TokenizerStates;(function(t){t[t.START=0]="START",t[t.ENDED=1]="ENDED",t[t.ERROR=2]="ERROR",t[t.TRUE1=3]="TRUE1",t[t.TRUE2=4]="TRUE2",t[t.TRUE3=5]="TRUE3",t[t.FALSE1=6]="FALSE1",t[t.FALSE2=7]="FALSE2",t[t.FALSE3=8]="FALSE3",t[t.FALSE4=9]="FALSE4",t[t.NULL1=10]="NULL1",t[t.NULL2=11]="NULL2",t[t.NULL3=12]="NULL3",t[t.STRING_DEFAULT=13]="STRING_DEFAULT",t[t.STRING_AFTER_BACKSLASH=14]="STRING_AFTER_BACKSLASH",t[t.STRING_UNICODE_DIGIT_1=15]="STRING_UNICODE_DIGIT_1",t[t.STRING_UNICODE_DIGIT_2=16]="STRING_UNICODE_DIGIT_2",t[t.STRING_UNICODE_DIGIT_3=17]="STRING_UNICODE_DIGIT_3",t[t.STRING_UNICODE_DIGIT_4=18]="STRING_UNICODE_DIGIT_4",t[t.STRING_INCOMPLETE_CHAR=19]="STRING_INCOMPLETE_CHAR",t[t.NUMBER_AFTER_INITIAL_MINUS=20]="NUMBER_AFTER_INITIAL_MINUS",t[t.NUMBER_AFTER_INITIAL_ZERO=21]="NUMBER_AFTER_INITIAL_ZERO",t[t.NUMBER_AFTER_INITIAL_NON_ZERO=22]="NUMBER_AFTER_INITIAL_NON_ZERO",t[t.NUMBER_AFTER_FULL_STOP=23]="NUMBER_AFTER_FULL_STOP",t[t.NUMBER_AFTER_DECIMAL=24]="NUMBER_AFTER_DECIMAL",t[t.NUMBER_AFTER_E=25]="NUMBER_AFTER_E",t[t.NUMBER_AFTER_E_AND_SIGN=26]="NUMBER_AFTER_E_AND_SIGN",t[t.NUMBER_AFTER_E_AND_DIGIT=27]="NUMBER_AFTER_E_AND_DIGIT"})(TokenizerStates||(TokenizerStates={}));class TokenizerError extends Error{constructor(e){super(e);Object.setPrototypeOf(this,TokenizerError.prototype)}}const{LEFT_BRACE:LEFT_BRACE1,RIGHT_BRACE:RIGHT_BRACE1,LEFT_BRACKET:LEFT_BRACKET1,RIGHT_BRACKET:RIGHT_BRACKET1,COLON:COLON1,COMMA:COMMA1,TRUE:TRUE1,FALSE:FALSE1,NULL:NULL1,STRING:STRING1,NUMBER:NUMBER1}=TokenType;var ParserState;(function(t){t[t.VALUE=0]="VALUE",t[t.KEY=1]="KEY",t[t.COLON=2]="COLON",t[t.COMMA=3]="COMMA",t[t.ENDED=4]="ENDED",t[t.ERROR=5]="ERROR"})(ParserState||(ParserState={}));var ParserMode;(function(t){t[t.OBJECT=0]="OBJECT",t[t.ARRAY=1]="ARRAY"})(ParserMode||(ParserMode={}));class TokenParserError extends Error{constructor(e){super(e);Object.setPrototypeOf(this,TokenParserError.prototype)}}new TextEncoder;async function using(t,e){try{return await e(t)}finally{await t.dispose()}}const responseTimeout=60*60*24*7;class BatchError extends Error{results;constructor(e,i){super(e);this.name="BatchError",this.results=i}}function normArgs(t){const e=[];for(const i of t){if(i===void 0)break;e.push(i)}return e}class DenopsImpl{name;meta;#e;constructor(e,i,r){this.name=e,this.meta=i,this.#e=r}get dispatcher(){return this.#e.dispatcher}set dispatcher(e){this.#e.dispatcher=e}async call(e,...i){return await this.#e.call("call",e,...normArgs(i))}async batch(...e){const i=e.map(([s,...o])=>[s,...normArgs(o)]),[r,n]=await this.#e.call("batch",...i);if(n!=="")throw new BatchError(n,r);return r}async cmd(e,i={}){await this.#e.call("call","denops#api#cmd",e,i)}async eval(e,i={}){return await this.#e.call("call","denops#api#eval",e,i)}async dispatch(e,i,...r){return await this.#e.call("dispatch",e,i,...r)}}const worker=self;async function main(t,e,i){const r=new WorkerReader(worker),n=new WorkerWriter(worker),s=await import(mod2.toFileUrl(e).href);await using(new Session(r,n,{},{responseTimeout,errorCallback(o){o.name!=="Interrupted"&&console.error(`Unexpected error occurred in '${t}'`,o)}}),async o=>{const l=new DenopsImpl(t,i,o);await l.call("execute",`doautocmd <nomodeline> User DenopsPluginPre:${t}`,""),await s.main(l),await l.call("execute",`doautocmd <nomodeline> User DenopsPluginPost:${t}`,""),await o.waitClosed()}),worker.terminate()}function isMeta(t){return!(!isObject(t)||!isString(t.mode)||!["release","debug","test"].includes(t.mode)||!isString(t.host)||!["vim","nvim"].includes(t.host)||!isString(t.version)||!isString(t.platform)||!["windows","mac","linux"].includes(t.platform))}worker.addEventListener("message",t=>{if(ensureObject(t.data),ensureString(t.data.name),ensureString(t.data.script),!isMeta(t.data.meta))throw new Error(`Invalid 'meta' is passed: ${t.data.meta}`);const{name:e,script:i,meta:r}=t.data;main(e,i,r).catch(n=>{console.error(`Unexpected error occured in '${e}' (${i}): ${n}`)})},{once:!0});
